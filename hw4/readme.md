Домашняя работа N4
==================

## ADR

[ADR-001 Улучшаем _availability_ сервиса тестирования кандидатов](./adr/001-improve-avalability-of-candidate-testing-service.md)


## Проблемы бизнеса, причины и решения

| Название проблемы | Из-за чего возникла проблема | Как проблема решилась |
|-------------------|------------------------------|-----------------------|
|Problem-010|Команда выполнения задания кандидатом выполняет синхронные вызовы в сервисы начисления бонусов и сервис управления заданиями. Это приводит к задержкам и неконсистентности данных в случае ошибок|Синхронные вызовы API были заменены отправкой асинхронных сообщений об успешном и неуспешном прохождении теста кандидатом.|
|Problem-020|Сервис тестирования кандидатов получал данных по pull-модели, из-за этого могли использоваться устаревшие данные|Получение данных было переделано на push модель, данные отправляются в сервис тестирования сразу после обновления задания.|
|Problem-030|Рейтинг попадал в систему начисления бонусов при помощи отправки асинхронного события. Из-за этого возникали расхождения между значением рейтинга в момент начисления бонуса в системе бонусов и значением рейтинга в системе тестирования.|В момент начисления бонусов сервис бонусов будет сихнронно получать актуальный рейтинг задания из сервиса тестирования.|
|Problem-040|Синхронные вызовы после прохождения тестирования кандидатом из системы тестирования в систему начисления бонусов создавали нагрузку на сервис начисления бонусов. Из-за всплесков нагрузки сервис начинал медленно отвечать и падал.|Синхронные вызовы были заменены на асинхронные события. Всплески сглаживаются брокером.|
|Problem-050|После успешного выполнения задания выполняются синхронные вызовы в систему начисления бонусов и сервис управления заданиями. Какой-то из этих вызовов может завершиться неудачей.|Так как для сервиса тестирования не нужен ответ ни от одного из сервисов и для бизнес-логики подходит eventual consistency синхронные вызовы были заменены на отправку асинхронных событий.|
|Problem-060|Синхронная коммуникация объединяет сервисы в один архитектурный квант с общими эксплуотационными характеристиками. Из-за этого сервисы могут масштабироваться только все вместе.| Большинство синхронных коммуникаций были заменены асихронными. Остались две синхронные связи: обновление задания в сервисе тестирования после редактирования в сервисе управления заданиями и синхронное получение рейтинга в сервисе начисления бонусов.|
|Problem-070|После успешного выполнения задания выполняются синхронные вызовы в систему начисления бонусов и сервис управления заданиями. Когда сервис управления заданиями падает и пользователь видит ошибку, он пытается отправить решение снова. Из-за этого повторяется вызов начисления бонусов.| Синхронные связи переделаны на асинхронные, реализована идемпотентность обработки событий с одинаковым ID.|
|Problem-080|Синхронная коммуникация объединяет сервисы в один архитектурный квант с общими эксплуотационными характеристиками. Из-за этого отказ одного сервиса влечет отказ всех сервисов сразу.|Синхронные коммуникации были заменены асинхронными. Отказ оставшихся синхронных вызовов не влияет на сервис тестирования кандидатов.|
|Problem-090|Коммуникация между сервисами была реализована в синхронном коммандном стиле. Каждый сервис знал о бизнес-логике соседних сервисов.|Командные синхронные коммуникации были заменены на реакционные асинхронные|
|Problem-100|Была неправильно реализована распределённая транзакция: в момент прохождения теста нужно было синхронно сделать модификацию данных в нескольких системах. Отказ в одной из них мог привести к неконсистентному состоянию системы.|На самом деле тут не нужны были распределённые транзакции. Синхронные вызовы, связанные с прохождением тестирования были заменены отправкой асинхронных событий.|
